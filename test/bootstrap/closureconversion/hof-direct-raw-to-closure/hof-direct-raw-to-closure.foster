// IN: 48 52

fx = { opaquely_i32 42 };

// This tests passing of top-level functions to higher-order
// Foster functions, which (pessimistically?) expect a closure.

read_i32 :: { Int32 } @ { proc = true };

main = {
  expect_i32 48 ; print_i32 (run-it { read_i32 () }); // Foster fn, anon
  expect_i32 52 ; print_i32 (run-it read_i32);        // C fn, directly
  check-shadowing();
  check-call-of-literal-function();
  force_gc_for_debugging_purposes();
};

check-call-of-literal-function = {
  expect_i32 55 ; { print_i32 55 }();
};

run-it = { f: {Int32} => f() };

check-shadowing = {
  expect_i32 50 ; // check shadowing of global names
  let read_i32 = { opaquely_i32 50 };
   in
      print_i32 (run-it read_i32);
  end;
};

