main = {
  expect_i32 1111111;
  expect_i32 2222222;
  expect_i32 4444444;
  expect_i32 10;
  expect_i32 6666;
  expect_i32 1234;
  expect_i32 20;
  expect_i32 5555555;
  expect_i32 6666666;
  expect_i32 7777;
  expect_i32 3333333;
  expect_i32 9999999;

  print_i32 1111111;
  let co = coro_create { x : Int32 =>
                print_i32 4444444;
                //force_gc_for_debugging_purposes !;
                print_i32 x; // 10
                let y = coro_yield:[Int32,Int32] 6666;
                   f2 = {
                    //force_gc_for_debugging_purposes !;
                    coro_yield:[Int32,Int32] y;
                    print_i32 5555555;
                    // force_gc_for_debugging_purposes !;
                    print_i32 6666666;
                    coro_yield:[Int32,Int32] 7777;
                    9999
                  };
                in f2 !;
                end;
          };
      //j0 = force_gc_for_debugging_purposes !;
      cr  = (ref co);
  in
      print_i32 2222222;
    //force_gc_for_debugging_purposes !;
      print_i32 (coro_invoke cr^ 10); // 6666
      print_i32 1234;
    //force_gc_for_debugging_purposes !;
      print_i32 (coro_invoke cr^ 20); // 20
    force_gc_for_debugging_purposes !;
      print_i32 (coro_invoke cr^ 30);
      print_i32 3333333;
      print_i32 9999999;
  end
};

