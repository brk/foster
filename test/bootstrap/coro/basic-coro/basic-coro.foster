// IN: 2 3 5 8 13

// coro_wrap = forall a b,
//             fn (f : fn(arg : a to b)) {
//               let c = coro_create(f) in {
//                 fn (arg : a) { coro_invoke(c, a) }
//               }
//             }

main = fn () {
  print_i32(1111111)
  let co = coro_create_i32_i32( fn(x : i32) {
                                        print_i32(4444444)
                                        force_gc_for_debugging_purposes()
                                        print_i32(x) // 10
                                        let y : i32 = coro_yield_i32_i32(6666) in {
                                            coro_yield_i32_i32(y)
                                            print_i32(5555555)
                                        //force_gc_for_debugging_purposes()
                                            print_i32(6666666)
                                            coro_yield_i32_i32(7777)
                                            9999
                                        }
                                 } ) in {
    print_i32(2222222)
  //force_gc_for_debugging_purposes()
    //print_i32(coro_invoke_i32_i32(co, 10)) // 6666
    print_i32(coro_invoke(co, 10)) // 6666
    print_i32(1234)
  //force_gc_for_debugging_purposes()
    print_i32(5678)
    print_i32(coro_invoke(co, 20)) // 20
    print_i32(coro_invoke_i32_i32(co, 30))
    print_i32(3333333)
  }
  print_i32(9999999)
}

